<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ko" lang="ko">
    <head>
        <title>Cross-Browser QRCode generator for Javascript</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta
            name="viewport"
            content="width=device-width,initial-scale=1,user-scalable=no"
        />
        <script type="text/javascript" src="jquery.min.js"></script>
        <script type="text/javascript" src="qrcode.js"></script>
    </head>
    <body>
        <div
            id="qrcode"
            style="width: 100px; height: 100px; margin-top: 15px"
        ></div>

        <script type="text/javascript">
            var qrcode = new QRCode(document.getElementById("qrcode"), {
                width: 100,
                height: 100,
            });
            let list = [];
            qrcode.makeCode("");

            function getURL() {
                var imageURL = document
                    .querySelector("img")
                    .getAttribute("src");
                list.push(imageURL);
            }

            function generateCodes(amount = 10) {
                const codes = new Set();
                while (codes.size < amount) {
                    let code = "";
                    for (let j = 0; j < 5; j++) {
                        code += Math.floor(Math.random() * 5);
                    }
                    codes.add(code);
                }
                return Array.from(codes);
            }
            
            function generateCodeList(codeList) {
                // Step 1: Create the content for the text file
                let content = "";
                for (let item of codeList) {
                    content += `${item}\n`
                }
                // Step 2: Create a Blob from the content
                const blob = new Blob([content], {
                    type: "text/plain",
                });

                // Step 3: Create a link element
                const a = document.createElement("a");

                // Step 4: Set the link to point to the Blob object
                const url = URL.createObjectURL(blob);
                a.href = url;
                a.download = "code_list.txt"; // The name of the file to be downloaded

                // Step 5: Trigger a click on the link to prompt the download
                document.body.appendChild(a); // Append the link to the body
                a.click(); // Programmatically click the link
                document.body.removeChild(a); // Remove the link from the body

                // Optionally, revoke the object URL to free up memory
                URL.revokeObjectURL(url);
            }

            function pause(msec) {
                return new Promise((resolve, reject) => {
                    setTimeout(resolve, msec || 1000);
                });
            }

            async function downloadAll(elements) {
                var count = 0;
                var link = document.createElement("a");

                for (var e in elements) {
                    link.href = elements[e];
                    link.download = "image.png"; // Replace 'png' with appropriate format
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);

                    if (++count >= 9) {
                        await pause(1000);
                        count = 0;
                    }
                }
            }

            function makeQrFromCodes() {
                const body = document.querySelector("body");
                const codes = generateCodes(100);
                for (let code of codes) {
                    qrcode.makeCode(`${code}`);
                    getURL();
                }
                // downloadAll(list);
                generateCodeList(codes);
            }

            window.onload = function () {
                makeQrFromCodes();
            };
        </script>
    </body>
</html>
